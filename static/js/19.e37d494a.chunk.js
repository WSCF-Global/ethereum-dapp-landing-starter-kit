(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[19],{1251:function(e,t,r){(function(t){function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=h(e);if(t){var i=h(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return l(this,r)}}function l(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=r(144),d=r(91).EventEmitter,p=r(1252),v="Lattice Hardware",y=2147483648,g=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(h,e);var r,n,o,l=c(h);function h(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a(this,h),(e=l.call(this)).type=v,e._resetDefaults(),e.deserialize(t),e}return r=h,(n=[{key:"deserialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.creds&&(this.creds=e.creds),e.accounts&&(this.accounts=e.accounts),e.walletUID&&(this.walletUID=e.walletUID),e.name&&(this.name=e.name),e.network&&(this.network=e.network),Promise.resolve()}},{key:"serialize",value:function(){return Promise.resolve({creds:this.creds,accounts:this.accounts,walletUID:this.walletUID,name:this.name,network:this.network})}},{key:"isUnlocked",value:function(){return this._hasCreds()&&this._hasSession()}},{key:"setHdPath",value:function(){console.warn("setHdPath not implemented.")}},{key:"unlock",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((function(r,n){e._getCreds().then((function(t){return t&&(e.creds.deviceID=t.deviceID,e.creds.password=t.password),e._initSession()})).then((function(){return e._connect(t)})).then((function(){return r("Unlocked")})).catch((function(e){return n(Error(e))}))}))}},{key:"addAccounts",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(r,n){e.unlock().then((function(){return e._fetchAddresses(t,e.unlockedAccount)})).then((function(n){var o;return e.accounts.splice(e.unlockedAccount,t),(o=e.accounts).splice.apply(o,[e.unlockedAccount,0].concat(i(n))),r(e.accounts)})).catch((function(e){return n(e)}))}))}},{key:"getAccounts",value:function(){return Promise.resolve(this.accounts?this.accounts.slice():[].slice())}},{key:"signTransaction",value:function(e,r){var n=this;return new Promise((function(i,o){n._unlockAndFindAccount(e).then((function(e){var t={chainId:r.getChainId(),nonce:Number("0x".concat(r.nonce.toString("hex")))||0,gasPrice:Number("0x".concat(r.gasPrice.toString("hex"))),gasLimit:Number("0x".concat(r.gasLimit.toString("hex"))),to:"0x".concat(r.to.toString("hex")),value:Number("0x".concat(r.value.toString("hex"))),data:0===r.data.length?null:"0x".concat(r.data.toString("hex")),signerPath:[2147483692,2147483708,y,0,e]};return n._signTxData(t)})).then((function(e){return e.sig&&e.sig.v&&e.sig.r&&e.sig.s?(r.v=e.sig.v,r.r=t.from(e.sig.r,"hex"),r.s=t.from(e.sig.s,"hex"),i(r)):o(Error("No signature returned"))})).catch((function(e){return o(Error(e))}))}))}},{key:"signMessage",value:function(e,t){return console.warn("NOTE: signMessage is currently a proxy for signPersonalMessage!"),this.signPersonalMessage(e,t)}},{key:"signPersonalMessage",value:function(e,t){var r=this;return new Promise((function(n,i){r._unlockAndFindAccount(e).then((function(e){var o={currency:"ETH_MSG",data:{protocol:"signPersonal",payload:t,signerPath:[2147483692,2147483708,y,0,e]}};if(!r._hasSession())return i("No SDK session started. Cannot sign transaction.");r.sdkSession.sign(o,(function(e,t){if(e)return i(e);if(!t.sig)return i("No signature returned");var r=(t.sig.v-27).toString(16);return r.length<2&&(r="0".concat(r)),n("0x".concat(t.sig.r).concat(t.sig.s).concat(r))}))}))}))}},{key:"exportAccount",value:function(e){return Promise.reject(Error("exportAccount not supported by this device"))}},{key:"removeAccount",value:function(e){this.forgetDevice()}},{key:"getFirstPage",value:function(){return this.page=0,this._getPage(1)}},{key:"getNextPage",value:function(){return this.getFirstPage()}},{key:"getPreviousPage",value:function(){return this.getFirstPage()}},{key:"setAccountToUnlock",value:function(e){this.unlockedAccount=parseInt(e,10)}},{key:"forgetDevice",value:function(){this._resetDefaults()}},{key:"_unlockAndFindAccount",value:function(e){var t=this;return new Promise((function(r,n){t.unlock(!1).then((function(){return t.getAccounts()})).then((function(t){var i=null;return t.forEach((function(t,r){e.toLowerCase()===t.toLowerCase()&&(i=r)})),null===i?n("Signer not present"):r(i)})).catch((function(e){return n(e)}))}))}},{key:"_resetDefaults",value:function(){this.accounts=[],this.isLocked=!0,this.creds={deviceID:null,password:null},this.walletUID=null,this.sdkSession=null,this.page=0,this.unlockedAccount=0,this.network=null}},{key:"_getCreds",value:function(){var e=this;return new Promise((function(t,r){if(e._hasCreds())return t();var n=e.name?e.name:"Unknown",i="https://wallet.gridplus.io";e.network&&"mainnet"!==e.network&&(i="https://gridplus-web-wallet-dev.herokuapp.com");var o="".concat(i,"?keyring=").concat(n);e.network&&(o+="&network=".concat(e.network)),window.open(o).postMessage("GET_LATTICE_CREDS",i),window.addEventListener("message",(function(e){if(e.origin===i)try{var n=JSON.parse(e.data);return n.deviceID&&n.password?t(n):r(Error("Invalid credentials returned from Lattice."))}catch(o){return r(o)}}),!1)}))}},{key:"_connect",value:function(e){var t=this;return new Promise((function(r,n){t.sdkSession.connect(t.creds.deviceID,(function(i){if(i)return n(i);var o=t.sdkSession.getActiveWallet();if(!o||!o.uid)return n("No active wallet");var a=o.uid.toString("hex");if(a!=t.walletUID){if(!1===e)return n("Wallet has changed! Please reconnect.");t.accounts=[],t.walletUID=a}return r()}))}))}},{key:"_initSession",value:function(){var e=this;return new Promise((function(t,r){if(e._hasSession())return t();try{var n="https://signing.gridpl.us";e.network&&"mainnet"!==e.network&&(n="https://signing.staging-gridpl.us");var i={name:e.name,baseUrl:n,crypto:f,timeout:12e4,privKey:e._genSessionKey(),network:e.network};return e.sdkSession=new p.Client(i),t()}catch(o){return r(o)}}))}},{key:"_fetchAddresses",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise((function(n,i){if(!e._hasSession())return i("No SDK session started. Cannot fetch addresses.");if(r>e.accounts.length)return i("Requested address is out of bounds. You may only request index <".concat(e.accounts.length));if(e.accounts.length>r)return n(e.accounts.slice(r,t));var o={currency:"ETH",startPath:[2147483692,2147483708,y,0,r],n:t};e.sdkSession.getAddresses(o,(function(e,t){return e?i(Error("Error getting addresses: ".concat(e))):t.length<1?i("No addresses returned"):n(t)}))}))}},{key:"_signTxData",value:function(e){var t=this;return new Promise((function(r,n){if(!t._hasSession())return n("No SDK session started. Cannot sign transaction.");t.sdkSession.sign({currency:"ETH",data:e},(function(e,t){return e?n(e):t.tx?r(t):n("No transaction payload returned.")}))}))}},{key:"_getPage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new Promise((function(r,n){e.page+=t,e.page<=0&&(e.page=1);var i=5*(e.page-1);e.page,e.unlock().then((function(){return e._fetchAddresses(1,0)})).then((function(e){var t=[];return e.forEach((function(e,r){t.push({address:e,balance:null,index:i+r})})),r(t)})).catch((function(e){return n(e)}))}))}},{key:"_hasCreds",value:function(){return null!==this.creds.deviceID&&null!==this.creds.password&&this.name}},{key:"_hasSession",value:function(){return this.sdkSession&&this.walletUID}},{key:"_genSessionKey",value:function(){if(!this._hasCreds())throw new Error("No credentials -- cannot create session key!");var e=t.concat([t.from(this.creds.password),t.from(this.creds.deviceID),t.from(this.name)]);return f.createHash("sha256").update(e).digest()}}])&&s(r.prototype,n),o&&s(r,o),h}(d);g.type=v,e.exports=g}).call(this,r(11).Buffer)},1252:function(e,t,r){var n=r(1253);e.exports={Client:n}},1253:function(e,t,r){var n=r(102),i=r(103),o=r(1254),a=r(994),s=r(995),u=r(1264),c=u.signReqResolver,l=u.aes256_decrypt,h=u.aes256_encrypt,f=u.parseDER,d=u.checksum,p=u.getP256KeyPair,v=u.getP256KeyPairFromPub,y=u.parseLattice1Response,g=u.toPaddedDER,E=r(804),w=E.ADDR_STR_LEN,_=E.ENC_MSG_LEN,m=E.decResLengths,b=E.deviceCodes,S=E.encReqCodes,R=E.responseCodes,T=E.REQUEST_TYPE_BYTE,I=E.VERSION_BYTE,k=E.messageConstants,A=E.BASE_URL,P=r(11).Buffer,x=P.alloc(32),U=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.baseUrl,i=t.crypto,o=t.name,a=t.privKey,s=t.timeout,u=t.retryCount;if(n(this,e),o&&o.length>24)throw new Error("name must be less than 24 characters");if(!i)throw new Error("crypto provider is required");this.baseUrl=r||A,this.crypto=i,this.name=o||"Unknown",this.privKey=a||this.crypto.randomBytes(32),this.key=p(this.privKey),this.ephemeralPub=null,this.sharedSecret=null,this.timeout=s||6e4,this.deviceId=null,this.isPaired=!1,this.retryCount=u||3,this.activeWallets={internal:{uid:x,name:null,capabilities:null,external:!1},external:{uid:x,name:null,capabilities:null,external:!0}}}return i(e,[{key:"connect",value:function(e,t){var r=this;if("function"===typeof e){if(!this.deviceId)return t("No device ID has been stored. Please connect with your device ID first.");t=e}else this.deviceId=e;var n=this._buildRequest(b.CONNECT,this.pubKeyBytes());this._request(n,(function(e,n){return e?t(e):(r.isPaired=r._handleConnect(n),r.isPaired?void r._getActiveWallet((function(e){return t(e,r.isPaired)}),!0):t(null))}))}},{key:"pair",value:function(e,t){var r=this,n=this.pubKeyBytes(),i=P.alloc(25);if(this.name.length>24)return t("Name is too many characters. Please change it to <25 characters.");i.write(this.name);var o=P.concat([n,i,P.from(e)]),a=this.crypto.createHash("sha256").update(o).digest(),s=this.key.sign(a),u=g(s),c=P.concat([i,u]),l=this._buildEncRequest(S.FINALIZE_PAIRING,c);this._request(l,(function(e,n){if(e)return t(e);var i=r._handlePair(n);if(i)return t(i);r._getActiveWallet((function(e){return e?t(e):t(null,r.hasActiveWallet())}),!0)}))}},{key:"test",value:function(e,t){var r=this;if(!e.payload)return t("First argument must contain `testID` and `payload` fields.");var n=P.alloc(506);n.writeUInt32BE(e.testID,0),n.writeUInt16BE(e.payload.length,4),e.payload.copy(n,6);var i=this._buildEncRequest(S.TEST,n);this._request(i,(function(e,n){if(e)return t(e);var i=r._handleEncResponse(n,m.test);return null!==i.err?t(i.err):t(null,i.data.slice(65))}))}},{key:"getAddresses",value:function(e,t){var r=this,n=e.startPath,i=e.n;if(void 0===n||void 0===i||5!==n.length)return t("Please provide `startPath` and `n` options");var o=P.alloc(33+4*n.length),a=0,s=this.getActiveWallet();if(null===s)return t("No active wallet.");s.uid.copy(o,a),a+=32;for(var u=0;u<n.length;u++)o.writeUInt32BE(n[u],a),a+=4;o.writeUInt8(i,a),a++;var c=this._buildEncRequest(S.GET_ADDRESSES,o);return this._request(c,(function(e,n){if(e)return t(e);var i=r._handleGetAddresses(n);return i.err?t(i.err):t(null,i.data)}))}},{key:"sign",value:function(e,t){var r=this,n=e.currency,i=e.data;if(void 0===n||void 0===i)return t("Please provide `currency` and `data` options");if(void 0===c[n])return t("Unsupported currency");var o=c[n](i);if(void 0!==o.err)return t({err:o.err});if(o.payload.length>1152)return t("Transaction is too large");var a=P.alloc(1154),s=0;a.writeUInt16BE(o.schema,s),s+=2;var u=this.getActiveWallet();if(null===u)return t("No active wallet.");u.uid.copy(a,s),s+=u.uid.length,o.payload.copy(a,s);var l=this._buildEncRequest(S.SIGN_TRANSACTION,a);return this._request(l,(function(i,a,s){if(s===R.RESP_ERR_WALLET_NOT_PRESENT)r._getActiveWallet((function(n){return n?t(n):r.sign(e,t)}));else{if(!i){var u=r._handleSign(a,n,o);return t(u.err,u.data)}if(i)return t(i)}}))}},{key:"_getActiveWallet",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!0===r||!0!==this.hasActiveWallet()&&!0===this.isPaired){var n=P.alloc(0),i=this._buildEncRequest(S.GET_WALLETS,n);return this._request(i,(function(r,n){return r?(t._resetActiveWallets(),e(r)):e(t._handleGetWallets(n))}))}return e(null)}},{key:"_getSharedSecret",value:function(){return P.from(this.key.derive(this.ephemeralPub.getPublic()).toArray("be",32))}},{key:"_getEphemId",value:function(){if(null===this.ephemeralPub)return null;var e=this._getSharedSecret();return this.crypto.createHash("sha256").update(e).digest().slice(0,4)}},{key:"_buildEncRequest",value:function(e,t){var r=parseInt(this._getEphemId().toString("hex"),16),n=P.concat([P.from([e]),t]),i=d(n),o=P.alloc(n.length+4);n.copy(o,0),o.writeUInt32LE(i,n.length);var a=this._getSharedSecret(),s=h(o,a),u=P.alloc(_+4);return u.writeUInt32LE(r,0),s.copy(u,4),this._buildRequest(b.ENCRYPTED_REQUEST,u)}},{key:"_buildRequest",value:function(e,t){var r=t&&P.isBuffer(t)?t.length+1:1;e===b.ENCRYPTED_REQUEST&&(r=1+t.length);var n=0,i=P.alloc(r+8);n=i.writeUInt8(I,n),n=i.writeUInt8(T,n);var o=this.crypto.randomBytes(4);n=i.writeUInt32BE(parseInt("0x".concat(o.toString("hex"))),n),n=i.writeUInt16BE(r,n),n=i.writeUInt8(e,n),r>1&&(n=t.copy(i,n));var a=d(i),s=P.alloc(i.length+4);return n=i.copy(s),s.writeUInt32BE(a,n),s}},{key:"_request",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.retryCount;if(!this.deviceId)return t("Serial is not set. Please set it and try again.");var i="".concat(this.baseUrl,"/").concat(this.deviceId);o.post(i).timeout(this.timeout).send({data:e}).then((function(i){if(!i||!i.body)return t("Invalid response: ".concat(i));if(200!==i.body.status)return t("Error code ".concat(i.body.status,": ").concat(i.body.message));var o=y(i.body.message);return(o.responseCode===R.RESP_ERR_DEV_BUSY||o.responseCode===R.RESP_ERR_GCE_TIMEOUT)&&n>0?setTimeout((function(){r._request(e,t,n-1)}),3e3):(o.responseCode===R.RESP_ERR_WALLET_NOT_PRESENT&&r._resetActiveWallets(),o.err?t(o.err):t(null,o.data,o.responseCode))})).catch((function(e){var r="ECONNABORTED"===e.code&&"ETIME"===e.errno;return t(r?"Timeout waiting for device. Please ensure it is connected to the internet and try again in a minute.":"Failed to make request to device.")}))}},{key:"_handleConnect",value:function(e){var t=0,r=e.readUInt8(t);t++;var n=e.slice(t,e.length).toString("hex");return this.ephemeralPub=v(n),r===k.PAIRED}},{key:"_handleEncResponse",value:function(e,t){var r=this._getSharedSecret(),n=e.slice(0,_),i=l(n,r);t+=65;var o=i.slice(0,t),a=parseInt("0x".concat(i.slice(t,t+4).toString("hex"))),s=d(o);if(a!==s)return{err:"Checksum mismatch in response from Lattice (calculated ".concat(s,", wanted ").concat(a,")")};var u=i.slice(0,65).toString("hex");try{return this.ephemeralPub=v(u),{err:null,data:i}}catch(c){return{err:"Error handling getAddresses response: ".concat(c.toString())}}}},{key:"_handlePair",value:function(e){var t=this._handleEncResponse(e,m.finalizePair);return t.err?t.err:(this.pairingSalt=null,this.isPaired=!0,null)}},{key:"_handleGetAddresses",value:function(e){var t=this._handleEncResponse(e,m.getAddresses);if(null!==t.err)return t;for(var r=t.data,n=65,i=[];n+4<m.getAddresses;){var o=r.slice(n,n+w);n+=w;var a=o.indexOf(0);a>0&&i.push(o.slice(0,a).toString())}return{data:i,err:null}}},{key:"_handleGetWallets",value:function(e){var t=this._handleEncResponse(e,m.getWallets);if(null!==t.err)return t;var r,n=t.data,i=65,o=!1;return r=n.slice(i,i+32),this.activeWallets.internal.uid=r,this.activeWallets.internal.capabilities=n.readUInt32BE(i+32),this.activeWallets.internal.name=n.slice(i+36,i+71),r.equals(x)||(o=!0),i+=71,r=n.slice(i,i+32),this.activeWallets.external.uid=r,this.activeWallets.external.capabilities=n.readUInt32BE(i+32),this.activeWallets.external.name=n.slice(i+36,i+71),r.equals(x)||(o=!0),!0===o?null:"No active wallet."}},{key:"_handleSign",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._handleEncResponse(e,m.sign);if(null!==n.err)return{err:n.err};var i,o=65,u=20,c=o,l=n.data;if("BTC"===t){var h=a.addressVersion[r.changeData.changeVersion],d=l.slice(c,c+u);c+=u,i=a.getBitcoinAddress(d,h)}var p={err:null,data:null},v=74,y=10*v,g=o+u+y;if("BTC"===t){for(var E=33,w=[],_=[],b=0;c<l.length&&48===l[c];){var S=c,R=c+2+l[c+1];_.push(l.slice(S,R));var T=b*E+g,I=(b+1)*E+g;w.push(l.slice(T,I)),c+=v,b+=1}var k={inputs:[],outputs:[],isSegwitSpend:r.origData.isSegwit,network:r.origData.network,crypto:this.crypto};k.outputs.push({value:r.origData.value,recipient:r.origData.recipient}),r.changeData.value>0&&k.outputs.push({value:r.changeData.value,recipient:i});for(var A=0;A<_.length;A++)k.inputs.push({hash:r.origData.prevOuts[A].txHash,index:r.origData.prevOuts[A].index,sig:_[A],pubkey:w[A]});var x=a.serializeTx(k),U=x;!0===k.isSegwitSpend&&(k.isSegwitSpend=!1,U=a.serializeTx(k));var D=this.crypto.createHash("sha256").update(P.from(U,"hex")).digest();D=this.crypto.createHash("sha256").update(D).digest().reverse().toString("hex"),p.data={tx:x,txHash:D,changeRecipient:i,sigs:_}}else if("ETH"===t){var C=f(l.slice(c,c+2+l[c+1]));c+=v;var N=l.slice(c,c+20),L=s.buildEthRawTx(r,C,N,r.useEIP155);p.data={tx:"0x".concat(L),txHash:"0x".concat(s.hashTransaction(L)),sig:{v:C.v,r:C.r.toString("hex"),s:C.s.toString("hex")},signer:N}}else if("ETH_MSG"===t){var O=f(l.slice(c,c+2+l[c+1]));c+=v;var H=l.slice(c,c+20),q=s.validateEthereumMsgResponse({signer:H,sig:O},r);p.data={sig:{v:q.v,r:q.r.toString("hex"),s:q.s.toString("hex")},signer:H}}return p}},{key:"_resetActiveWallets",value:function(){this.activeWallets.internal.uid=x,this.activeWallets.internal.name=null,this.activeWallets.internal.capabilities=null,this.activeWallets.external.uid=x,this.activeWallets.external.name=null,this.activeWallets.external.capabilities=null}},{key:"getActiveWallet",value:function(){return x.equals(this.activeWallets.external.uid)?x.equals(this.activeWallets.internal.uid)?null:this.activeWallets.internal:this.activeWallets.external}},{key:"hasActiveWallet",value:function(){return null!==this.getActiveWallet()}},{key:"pubKeyBytes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.key.getPublic(),r=t.encode("hex"),n=P.from(r,"hex");if(!0===e){var i=n.slice(1,33).reverse(),o=n.slice(33,65).reverse();return P.concat([n[0],i,o])}return n}}]),e}();e.exports=U},1254:function(e,t,r){var n;"undefined"!==typeof window?n=window:"undefined"!==typeof self?n=self:(console.warn("Using browser-only version of superagent in non-browser environment"),n=this);var i=r(1255),o=r(1256),a=r(993),s=r(1257),u=r(1259);function c(){}var l=t=e.exports=function(e,r){return"function"==typeof r?new t.Request("GET",e).end(r):1==arguments.length?new t.Request("GET",e):new t.Request(e,r)};t.Request=g,l.getXHR=function(){if(!(!n.XMLHttpRequest||n.location&&"file:"==n.location.protocol&&n.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}throw Error("Browser-only version of superagent could not find XHR")};var h="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};function f(e){if(!a(e))return e;var t=[];for(var r in e)d(t,r,e[r]);return t.join("&")}function d(e,t,r){if(null!=r)if(Array.isArray(r))r.forEach((function(r){d(e,t,r)}));else if(a(r))for(var n in r)d(e,t+"["+n+"]",r[n]);else e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));else null===r&&e.push(encodeURIComponent(t))}function p(e){for(var t,r,n={},i=e.split("&"),o=0,a=i.length;o<a;++o)-1==(r=(t=i[o]).indexOf("="))?n[decodeURIComponent(t)]="":n[decodeURIComponent(t.slice(0,r))]=decodeURIComponent(t.slice(r+1));return n}function v(e){return/[\/+]json($|[^-\w])/.test(e)}function y(e){this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"===typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var t=this.xhr.status;1223===t&&(t=204),this._setStatusProperties(t),this.header=this.headers=function(e){for(var t,r,n,i,o=e.split(/\r?\n/),a={},s=0,u=o.length;s<u;++s)-1!==(t=(r=o[s]).indexOf(":"))&&(n=r.slice(0,t).toLowerCase(),i=h(r.slice(t+1)),a[n]=i);return a}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&e._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function g(e,t){var r=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",(function(){var e,t=null,n=null;try{n=new y(r)}catch(i){return(t=new Error("Parser is unable to parse the response")).parse=!0,t.original=i,r.xhr?(t.rawResponse="undefined"==typeof r.xhr.responseType?r.xhr.responseText:r.xhr.response,t.status=r.xhr.status?r.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),r.callback(t)}r.emit("response",n);try{r._isResponseOK(n)||(e=new Error(n.statusText||"Unsuccessful HTTP response"))}catch(o){e=o}e?(e.original=t,e.response=n,e.status=n.status,r.callback(e,n)):r.callback(null,n)}))}function E(e,t,r){var n=l("DELETE",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}l.serializeObject=f,l.parseString=p,l.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},l.serialize={"application/x-www-form-urlencoded":f,"application/json":JSON.stringify},l.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse},s(y.prototype),y.prototype._parseBody=function(e){var t=l.parse[this.type];return this.req._parser?this.req._parser(this,e):(!t&&v(this.type)&&(t=l.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null)},y.prototype.toError=function(){var e=this.req,t=e.method,r=e.url,n="cannot "+t+" "+r+" ("+this.status+")",i=new Error(n);return i.status=this.status,i.method=t,i.url=r,i},l.Response=y,i(g.prototype),o(g.prototype),g.prototype.type=function(e){return this.set("Content-Type",l.types[e]||e),this},g.prototype.accept=function(e){return this.set("Accept",l.types[e]||e),this},g.prototype.auth=function(e,t,r){1===arguments.length&&(t=""),"object"===typeof t&&null!==t&&(r=t,t=""),r||(r={type:"function"===typeof btoa?"basic":"auto"});var n=function(e){if("function"===typeof btoa)return btoa(e);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(e,t,r,n)},g.prototype.query=function(e){return"string"!=typeof e&&(e=f(e)),e&&this._query.push(e),this},g.prototype.attach=function(e,t,r){if(t){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(e,t,r||t.name)}return this},g.prototype._getFormData=function(){return this._formData||(this._formData=new n.FormData),this._formData},g.prototype.callback=function(e,t){if(this._shouldRetry(e,t))return this._retry();var r=this._callback;this.clearTimeout(),e&&(this._maxRetries&&(e.retries=this._retries-1),this.emit("error",e)),r(e,t)},g.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},g.prototype.buffer=g.prototype.ca=g.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},g.prototype.pipe=g.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},g.prototype._isHost=function(e){return e&&"object"===typeof e&&!Array.isArray(e)&&"[object Object]"!==Object.prototype.toString.call(e)},g.prototype.end=function(e){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=e||c,this._finalizeQueryString(),this._end()},g.prototype._end=function(){var e=this,t=this.xhr=l.getXHR(),r=this._formData||this._data;this._setTimeouts(),t.onreadystatechange=function(){var r=t.readyState;if(r>=2&&e._responseTimeoutTimer&&clearTimeout(e._responseTimeoutTimer),4==r){var n;try{n=t.status}catch(i){n=0}if(!n){if(e.timedout||e._aborted)return;return e.crossDomainError()}e.emit("end")}};var n=function(t,r){r.total>0&&(r.percent=r.loaded/r.total*100),r.direction=t,e.emit("progress",r)};if(this.hasListeners("progress"))try{t.onprogress=n.bind(null,"download"),t.upload&&(t.upload.onprogress=n.bind(null,"upload"))}catch(s){}try{this.username&&this.password?t.open(this.method,this.url,!0,this.username,this.password):t.open(this.method,this.url,!0)}catch(u){return this.callback(u)}if(this._withCredentials&&(t.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof r&&!this._isHost(r)){var i=this._header["content-type"],o=this._serializer||l.serialize[i?i.split(";")[0]:""];!o&&v(i)&&(o=l.serialize["application/json"]),o&&(r=o(r))}for(var a in this.header)null!=this.header[a]&&this.header.hasOwnProperty(a)&&t.setRequestHeader(a,this.header[a]);return this._responseType&&(t.responseType=this._responseType),this.emit("request",this),t.send("undefined"!==typeof r?r:null),this},l.agent=function(){return new u},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(e){u.prototype[e.toLowerCase()]=function(t,r){var n=new l.Request(e,t);return this._setDefaults(n),r&&n.end(r),n}})),u.prototype.del=u.prototype.delete,l.get=function(e,t,r){var n=l("GET",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},l.head=function(e,t,r){var n=l("HEAD",e);return"function"==typeof t&&(r=t,t=null),t&&n.query(t),r&&n.end(r),n},l.options=function(e,t,r){var n=l("OPTIONS",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.del=E,l.delete=E,l.patch=function(e,t,r){var n=l("PATCH",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.post=function(e,t,r){var n=l("POST",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n},l.put=function(e,t,r){var n=l("PUT",e);return"function"==typeof t&&(r=t,t=null),t&&n.send(t),r&&n.end(r),n}},1255:function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},1256:function(e,t,r){"use strict";var n=r(993);function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},i.prototype.parse=function(e){return this._parser=e,this},i.prototype.responseType=function(e){return this._responseType=e,this},i.prototype.serialize=function(e){return this._serializer=e,this},i.prototype.timeout=function(e){if(!e||"object"!==typeof e)return this._timeout=e,this._responseTimeout=0,this;for(var t in e)switch(t){case"deadline":this._timeout=e.deadline;break;case"response":this._responseTimeout=e.response;break;default:console.warn("Unknown timeout option",t)}return this},i.prototype.retry=function(e,t){return 0!==arguments.length&&!0!==e||(e=1),e<=0&&(e=0),this._maxRetries=e,this._retries=0,this._retryCallback=t,this};var o=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];i.prototype._shouldRetry=function(e,t){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var r=this._retryCallback(e,t);if(!0===r)return!0;if(!1===r)return!1}catch(n){console.error(n)}if(t&&t.status&&t.status>=500&&501!=t.status)return!0;if(e){if(e.code&&~o.indexOf(e.code))return!0;if(e.timeout&&"ECONNABORTED"==e.code)return!0;if(e.crossDomain)return!0}return!1},i.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},i.prototype.then=function(e,t){if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(e,t){r.end((function(r,n){r?t(r):e(n)}))}))}return this._fullfilledPromise.then(e,t)},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.use=function(e){return e(this),this},i.prototype.ok=function(e){if("function"!==typeof e)throw Error("Callback required");return this._okCallback=e,this},i.prototype._isResponseOK=function(e){return!!e&&(this._okCallback?this._okCallback(e):e.status>=200&&e.status<300)},i.prototype.get=function(e){return this._header[e.toLowerCase()]},i.prototype.getHeader=i.prototype.get,i.prototype.set=function(e,t){if(n(e)){for(var r in e)this.set(r,e[r]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},i.prototype.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},i.prototype.field=function(e,t){if(null===e||void 0===e)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),n(e)){for(var r in e)this.field(r,e[r]);return this}if(Array.isArray(t)){for(var i in t)this.field(e,t[i]);return this}if(null===t||void 0===t)throw new Error(".field(name, val) val can not be empty");return"boolean"===typeof t&&(t=""+t),this._getFormData().append(e,t),this},i.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},i.prototype._auth=function(e,t,r,n){switch(r.type){case"basic":this.set("Authorization","Basic "+n(e+":"+t));break;case"auto":this.username=e,this.password=t;break;case"bearer":this.set("Authorization","Bearer "+e)}return this},i.prototype.withCredentials=function(e){return void 0==e&&(e=!0),this._withCredentials=e,this},i.prototype.redirects=function(e){return this._maxRedirects=e,this},i.prototype.maxResponseSize=function(e){if("number"!==typeof e)throw TypeError("Invalid argument");return this._maxResponseSize=e,this},i.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},i.prototype.send=function(e){var t=n(e),r=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),t&&!this._data)Array.isArray(e)?this._data=[]:this._isHost(e)||(this._data={});else if(e&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(t&&n(this._data))for(var i in e)this._data[i]=e[i];else"string"==typeof e?(r||this.type("form"),r=this._header["content-type"],this._data="application/x-www-form-urlencoded"==r?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||this._isHost(e)||r||this.type("json"),this},i.prototype.sortQuery=function(e){return this._sort="undefined"===typeof e||e,this},i.prototype._finalizeQueryString=function(){var e=this._query.join("&");if(e&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+e),this._query.length=0,this._sort){var t=this.url.indexOf("?");if(t>=0){var r=this.url.substring(t+1).split("&");"function"===typeof this._sort?r.sort(this._sort):r.sort(),this.url=this.url.substring(0,t)+"?"+r.join("&")}}},i.prototype._appendQueryString=function(){console.trace("Unsupported")},i.prototype._timeoutError=function(e,t,r){if(!this._aborted){var n=new Error(e+t+"ms exceeded");n.timeout=t,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.abort(),this.callback(n)}},i.prototype._setTimeouts=function(){var e=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){e._timeoutError("Timeout of ",e._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){e._timeoutError("Response timeout of ",e._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))}},1257:function(e,t,r){"use strict";var n=r(1258);function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.get=function(e){return this.header[e.toLowerCase()]},i.prototype._setHeaderProperties=function(e){var t=e["content-type"]||"";this.type=n.type(t);var r=n.params(t);for(var i in r)this[i]=r[i];this.links={};try{e.link&&(this.links=n.parseLinks(e.link))}catch(o){}},i.prototype._setStatusProperties=function(e){var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.redirect=3==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.created=201==e,this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.forbidden=403==e,this.notFound=404==e,this.unprocessableEntity=422==e}},1258:function(e,t,r){"use strict";t.type=function(e){return e.split(/ *; */).shift()},t.params=function(e){return e.split(/ *; */).reduce((function(e,t){var r=t.split(/ *= */),n=r.shift(),i=r.shift();return n&&i&&(e[n]=i),e}),{})},t.parseLinks=function(e){return e.split(/ *, */).reduce((function(e,t){var r=t.split(/ *; */),n=r[0].slice(1,-1);return e[r[1].split(/ *= */)[1].slice(1,-1)]=n,e}),{})},t.cleanHeader=function(e,t){return delete e["content-type"],delete e["content-length"],delete e["transfer-encoding"],delete e.host,t&&(delete e.authorization,delete e.cookie),e}},1259:function(e,t){function r(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach((function(e){r.prototype[e]=function(){return this._defaults.push({fn:e,arguments:arguments}),this}})),r.prototype._setDefaults=function(e){this._defaults.forEach((function(t){e[t.fn].apply(e,t.arguments)}))},e.exports=r},1260:function(e,t,r){var n=r(213),i=r(11).Buffer;function o(e,t){if("00"===e.slice(0,2))throw new Error("invalid RLP: extra zeros");return parseInt(e,t)}function a(e,t){if(e<56)return new i([e+t]);var r=c(e),n=c(t+55+r.length/2);return new i(n+r,"hex")}function s(e){var t,r,n,a,u,c=[],l=e[0];if(l<=127)return{data:e.slice(0,1),remainder:e.slice(1)};if(l<=183){if(t=l-127,n=128===l?new i([]):e.slice(1,t),2===t&&n[0]<128)throw new Error("invalid rlp encoding: byte must be less 0x80");return{data:n,remainder:e.slice(t)}}if(l<=191){if(r=l-182,t=o(e.slice(1,r).toString("hex"),16),(n=e.slice(r,t+r)).length<t)throw new Error("invalid RLP");return{data:n,remainder:e.slice(t+r)}}if(l<=247){for(t=l-191,a=e.slice(1,t);a.length;)u=s(a),c.push(u.data),a=u.remainder;return{data:c,remainder:e.slice(t)}}var h=(r=l-246)+(t=o(e.slice(1,r).toString("hex"),16));if(h>e.length)throw new Error("invalid rlp: total length is larger than the data");if(0===(a=e.slice(r,h)).length)throw new Error("invalid rlp, List has a invalid length");for(;a.length;)u=s(a),c.push(u.data),a=u.remainder;return{data:c,remainder:e.slice(h)}}function u(e){return"0x"===e.slice(0,2)}function c(e){var t=e.toString(16);return t.length%2&&(t="0"+t),t}function l(e){if(!i.isBuffer(e))if("string"===typeof e)e=u(e)?new i(((t="string"!==typeof(r=e)?r:u(r)?r.slice(2):r).length%2&&(t="0"+t),t),"hex"):new i(e);else if("number"===typeof e)e=e?function(e){var t=c(e);return new i(t,"hex")}(e):new i([]);else if(null===e||void 0===e)e=new i([]);else{if(!e.toArray)throw new Error("invalid type");e=new i(e.toArray())}var t,r;return e}t.encode=function(e){if(e instanceof Array){for(var r=[],n=0;n<e.length;n++)r.push(t.encode(e[n]));var o=i.concat(r);return i.concat([a(o.length,192),o])}return 1===(e=l(e)).length&&e[0]<128?e:i.concat([a(e.length,128),e])},t.decode=function(e,t){if(!e||0===e.length)return new i([]);var r=s(e=l(e));return t?r:(n.equal(r.remainder.length,0,"invalid remainder"),r.data)},t.getLength=function(e){if(!e||0===e.length)return new i([]);var t=(e=l(e))[0];if(t<=127)return e.length;if(t<=183)return t-127;if(t<=191)return t-182;if(t<=247)return t-191;var r=t-246;return r+o(e.slice(1,r).toString("hex"),16)}},1261:function(e,t,r){e.exports=r(1262)(r(1263))},1262:function(e,t,r){var n=r(93),i="Impossible case. Please create issue.",o="The tweak was out of range or the resulted private key is invalid",a="The tweak was out of range or equal to zero",s="Unknow error on context randomization",u="Private Key is invalid",c="Public Key could not be parsed",l="Public Key serialization error",h="The sum of the public keys is not valid",f="Signature could not be parsed",d="The nonce generation function failed, or the private key was invalid",p="Public key could not be recover",v="Scalar was invalid (zero or overflow)";function y(e,t){if(!e)throw new Error(t)}function g(e,t,r){if(y(t instanceof Uint8Array,"Expected ".concat(e," to be an Uint8Array")),void 0!==r)if(Array.isArray(r)){var n=r.join(", "),i="Expected ".concat(e," to be an Uint8Array with length [").concat(n,"]");y(r.includes(t.length),i)}else{var o="Expected ".concat(e," to be an Uint8Array with length ").concat(r);y(t.length===r,o)}}function E(e){y("Boolean"===_(e),"Expected compressed to be a Boolean")}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return new Uint8Array(e)},t=arguments.length>1?arguments[1]:void 0;return"function"===typeof e&&(e=e(t)),g("output",e,t),e}function _(e){return Object.prototype.toString.call(e).slice(8,-1)}e.exports=function(e){return{contextRandomize:function(t){switch(y(null===t||t instanceof Uint8Array,"Expected seed to be an Uint8Array or null"),null!==t&&g("seed",t,32),e.contextRandomize(t)){case 1:throw new Error(s)}},privateKeyVerify:function(t){return g("private key",t,32),0===e.privateKeyVerify(t)},privateKeyNegate:function(t){switch(g("private key",t,32),e.privateKeyNegate(t)){case 0:return t;case 1:throw new Error(i)}},privateKeyTweakAdd:function(t,r){switch(g("private key",t,32),g("tweak",r,32),e.privateKeyTweakAdd(t,r)){case 0:return t;case 1:throw new Error(o)}},privateKeyTweakMul:function(t,r){switch(g("private key",t,32),g("tweak",r,32),e.privateKeyTweakMul(t,r)){case 0:return t;case 1:throw new Error(a)}},publicKeyVerify:function(t){return g("public key",t,[33,65]),0===e.publicKeyVerify(t)},publicKeyCreate:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;switch(g("private key",t,32),E(r),n=w(n,r?33:65),e.publicKeyCreate(n,t)){case 0:return n;case 1:throw new Error(u);case 2:throw new Error(l)}},publicKeyConvert:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;switch(g("public key",t,[33,65]),E(r),n=w(n,r?33:65),e.publicKeyConvert(n,t)){case 0:return n;case 1:throw new Error(c);case 2:throw new Error(l)}},publicKeyNegate:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;switch(g("public key",t,[33,65]),E(r),n=w(n,r?33:65),e.publicKeyNegate(n,t)){case 0:return n;case 1:throw new Error(c);case 2:throw new Error(i);case 3:throw new Error(l)}},publicKeyCombine:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;y(Array.isArray(t),"Expected public keys to be an Array"),y(t.length>0,"Expected public keys array will have more than zero items");var o,a=n(t);try{for(a.s();!(o=a.n()).done;){var s=o.value;g("public key",s,[33,65])}}catch(u){a.e(u)}finally{a.f()}switch(E(r),i=w(i,r?33:65),e.publicKeyCombine(i,t)){case 0:return i;case 1:throw new Error(c);case 2:throw new Error(h);case 3:throw new Error(l)}},publicKeyTweakAdd:function(t,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;switch(g("public key",t,[33,65]),g("tweak",r,32),E(n),i=w(i,n?33:65),e.publicKeyTweakAdd(i,t,r)){case 0:return i;case 1:throw new Error(c);case 2:throw new Error(o)}},publicKeyTweakMul:function(t,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;switch(g("public key",t,[33,65]),g("tweak",r,32),E(n),i=w(i,n?33:65),e.publicKeyTweakMul(i,t,r)){case 0:return i;case 1:throw new Error(c);case 2:throw new Error(a)}},signatureNormalize:function(t){switch(g("signature",t,64),e.signatureNormalize(t)){case 0:return t;case 1:throw new Error(f)}},signatureExport:function(t,r){g("signature",t,64);var n={output:r=w(r,72),outputlen:72};switch(e.signatureExport(n,t)){case 0:return r.slice(0,n.outputlen);case 1:throw new Error(f);case 2:throw new Error(i)}},signatureImport:function(t,r){switch(g("signature",t),r=w(r,64),e.signatureImport(r,t)){case 0:return r;case 1:throw new Error(f);case 2:throw new Error(i)}},ecdsaSign:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;g("message",t,32),g("private key",r,32),y("Object"===_(n),"Expected options to be an Object"),void 0!==n.data&&g("options.data",n.data),void 0!==n.noncefn&&y("Function"===_(n.noncefn),"Expected options.noncefn to be a Function");var a={signature:o=w(o,64),recid:null};switch(e.ecdsaSign(a,t,r,n.data,n.noncefn)){case 0:return a;case 1:throw new Error(d);case 2:throw new Error(i)}},ecdsaVerify:function(t,r,n){switch(g("signature",t,64),g("message",r,32),g("public key",n,[33,65]),e.ecdsaVerify(t,r,n)){case 0:return!0;case 3:return!1;case 1:throw new Error(f);case 2:throw new Error(c)}},ecdsaRecover:function(t,r,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4?arguments[4]:void 0;switch(g("signature",t,64),y("Number"===_(r)&&r>=0&&r<=3,"Expected recovery id to be a Number within interval [0, 3]"),g("message",n,32),E(o),a=w(a,o?33:65),e.ecdsaRecover(a,t,r,n)){case 0:return a;case 1:throw new Error(f);case 2:throw new Error(p);case 3:throw new Error(i)}},ecdh:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;switch(g("public key",t,[33,65]),g("private key",r,32),y("Object"===_(n),"Expected options to be an Object"),void 0!==n.data&&g("options.data",n.data),void 0!==n.hashfn?(y("Function"===_(n.hashfn),"Expected options.hashfn to be a Function"),void 0!==n.xbuf&&g("options.xbuf",n.xbuf,32),void 0!==n.ybuf&&g("options.ybuf",n.ybuf,32),g("output",i)):i=w(i,32),e.ecdh(i,t,r,n.data,n.hashfn,n.xbuf,n.ybuf)){case 0:return i;case 1:throw new Error(c);case 2:throw new Error(v)}}}}},1263:function(e,t,r){var n=new(0,r(104).ec)("secp256k1"),i=n.curve,o=i.n.constructor;function a(e){var t=e[0];switch(t){case 2:case 3:return 33!==e.length?null:function(e,t){var r=new o(t);if(r.cmp(i.p)>=0)return null;var a=(r=r.toRed(i.red)).redSqr().redIMul(r).redIAdd(i.b).redSqrt();return 3===e!==a.isOdd()&&(a=a.redNeg()),n.keyPair({pub:{x:r,y:a}})}(t,e.subarray(1,33));case 4:case 6:case 7:return 65!==e.length?null:function(e,t,r){var a=new o(t),s=new o(r);if(a.cmp(i.p)>=0||s.cmp(i.p)>=0)return null;if(a=a.toRed(i.red),s=s.toRed(i.red),(6===e||7===e)&&s.isOdd()!==(7===e))return null;var u=a.redSqr().redIMul(a);return s.redSqr().redISub(u.redIAdd(i.b)).isZero()?n.keyPair({pub:{x:a,y:s}}):null}(t,e.subarray(1,33),e.subarray(33,65));default:return null}}function s(e,t){for(var r=t.encode(null,33===e.length),n=0;n<e.length;++n)e[n]=r[n]}e.exports={contextRandomize:function(){return 0},privateKeyVerify:function(e){var t=new o(e);return t.cmp(i.n)<0&&!t.isZero()?0:1},privateKeyNegate:function(e){var t=new o(e),r=i.n.sub(t).umod(i.n).toArrayLike(Uint8Array,"be",32);return e.set(r),0},privateKeyTweakAdd:function(e,t){var r=new o(t);if(r.cmp(i.n)>=0)return 1;if(r.iadd(new o(e)),r.cmp(i.n)>=0&&r.isub(i.n),r.isZero())return 1;var n=r.toArrayLike(Uint8Array,"be",32);return e.set(n),0},privateKeyTweakMul:function(e,t){var r=new o(t);if(r.cmp(i.n)>=0||r.isZero())return 1;r.imul(new o(e)),r.cmp(i.n)>=0&&(r=r.umod(i.n));var n=r.toArrayLike(Uint8Array,"be",32);return e.set(n),0},publicKeyVerify:function(e){return null===a(e)?1:0},publicKeyCreate:function(e,t){var r=new o(t);return r.cmp(i.n)>=0||r.isZero()?1:(s(e,n.keyFromPrivate(t).getPublic()),0)},publicKeyConvert:function(e,t){var r=a(t);return null===r?1:(s(e,r.getPublic()),0)},publicKeyNegate:function(e,t){var r=a(t);if(null===r)return 1;var n=r.getPublic();return n.y=n.y.redNeg(),s(e,n),0},publicKeyCombine:function(e,t){for(var r=new Array(t.length),n=0;n<t.length;++n)if(r[n]=a(t[n]),null===r[n])return 1;for(var i=r[0].getPublic(),o=1;o<r.length;++o)i=i.add(r[o].pub);return i.isInfinity()?2:(s(e,i),0)},publicKeyTweakAdd:function(e,t,r){var n=a(t);if(null===n)return 1;if((r=new o(r)).cmp(i.n)>=0)return 2;var u=n.getPublic().add(i.g.mul(r));return u.isInfinity()?2:(s(e,u),0)},publicKeyTweakMul:function(e,t,r){var n=a(t);return null===n?1:(r=new o(r)).cmp(i.n)>=0||r.isZero()?2:(s(e,n.getPublic().mul(r)),0)},signatureNormalize:function(e){var t=new o(e.subarray(0,32)),r=new o(e.subarray(32,64));return t.cmp(i.n)>=0||r.cmp(i.n)>=0?1:(1===r.cmp(n.nh)&&e.set(i.n.sub(r).toArrayLike(Uint8Array,"be",32),32),0)},signatureExport:function(e,t){var r=t.subarray(0,32),n=t.subarray(32,64);if(new o(r).cmp(i.n)>=0)return 1;if(new o(n).cmp(i.n)>=0)return 1;var a=e.output,s=a.subarray(4,37);s[0]=0,s.set(r,1);for(var u=33,c=0;u>1&&0===s[c]&&!(128&s[c+1]);--u,++c);if(128&(s=s.subarray(c))[0])return 1;if(u>1&&0===s[0]&&!(128&s[1]))return 1;var l=a.subarray(39,72);l[0]=0,l.set(n,1);for(var h=33,f=0;h>1&&0===l[f]&&!(128&l[f+1]);--h,++f);return 128&(l=l.subarray(f))[0]||h>1&&0===l[0]&&!(128&l[1])?1:(e.outputlen=6+u+h,a[0]=48,a[1]=e.outputlen-2,a[2]=2,a[3]=s.length,a.set(s,4),a[4+u]=2,a[5+u]=l.length,a.set(l,6+u),0)},signatureImport:function(e,t){if(t.length<8)return 1;if(t.length>72)return 1;if(48!==t[0])return 1;if(t[1]!==t.length-2)return 1;if(2!==t[2])return 1;var r=t[3];if(0===r)return 1;if(5+r>=t.length)return 1;if(2!==t[4+r])return 1;var n=t[5+r];if(0===n)return 1;if(6+r+n!==t.length)return 1;if(128&t[4])return 1;if(r>1&&0===t[4]&&!(128&t[5]))return 1;if(128&t[r+6])return 1;if(n>1&&0===t[r+6]&&!(128&t[r+7]))return 1;var a=t.subarray(4,4+r);if(33===a.length&&0===a[0]&&(a=a.subarray(1)),a.length>32)return 1;var s=t.subarray(6+r);if(33===s.length&&0===s[0]&&(s=s.slice(1)),s.length>32)throw new Error("S length is too long");var u=new o(a);u.cmp(i.n)>=0&&(u=new o(0));var c=new o(t.subarray(6+r));return c.cmp(i.n)>=0&&(c=new o(0)),e.set(u.toArrayLike(Uint8Array,"be",32),0),e.set(c.toArrayLike(Uint8Array,"be",32),32),0},ecdsaSign:function(e,t,r,a,s){if(s){var u=s;s=function(e){var n=u(t,r,null,a,e);if(!(n instanceof Uint8Array&&32===n.length))throw new Error("This is the way");return new o(n)}}var c,l=new o(r);if(l.cmp(i.n)>=0||l.isZero())return 1;try{c=n.sign(t,r,{canonical:!0,k:s,pers:a})}catch(h){return 1}return e.signature.set(c.r.toArrayLike(Uint8Array,"be",32),0),e.signature.set(c.s.toArrayLike(Uint8Array,"be",32),32),e.recid=c.recoveryParam,0},ecdsaVerify:function(e,t,r){var s={r:e.subarray(0,32),s:e.subarray(32,64)},u=new o(s.r),c=new o(s.s);if(u.cmp(i.n)>=0||c.cmp(i.n)>=0)return 1;if(1===c.cmp(n.nh)||u.isZero()||c.isZero())return 3;var l=a(r);if(null===l)return 2;var h=l.getPublic();return n.verify(t,s,h)?0:3},ecdsaRecover:function(e,t,r,a){var u,c={r:t.slice(0,32),s:t.slice(32,64)},l=new o(c.r),h=new o(c.s);if(l.cmp(i.n)>=0||h.cmp(i.n)>=0)return 1;if(l.isZero()||h.isZero())return 2;try{u=n.recoverPubKey(a,c,r)}catch(f){return 2}return s(e,u),0},ecdh:function(e,t,r,s,u,c,l){var h=a(t);if(null===h)return 1;var f=new o(r);if(f.cmp(i.n)>=0||f.isZero())return 2;var d=h.getPublic().mul(f);if(void 0===u)for(var p=d.encode(null,!0),v=n.hash().update(p).digest(),y=0;y<32;++y)e[y]=v[y];else{c||(c=new Uint8Array(32));for(var g=d.getX().toArray("be",32),E=0;E<32;++E)c[E]=g[E];l||(l=new Uint8Array(32));for(var w=d.getY().toArray("be",32),_=0;_<32;++_)l[_]=w[_];var m=u(c,l,s);if(!(m instanceof Uint8Array&&m.length===e.length))return 2;e.set(m)}return 0}}},1264:function(e,t,r){var n=r(994).buildBitcoinTxRequest,i=r(995),o=i.buildEthereumTxRequest,a=i.buildEthereumMsgRequest,s=r(11).Buffer,u=r(951),c=r(1265),l=r(104),h=r(804),f=h.AES_IV,d=h.responseCodes,p=h.responseMsgs,v=h.VERSION_BYTE,y=new(0,l.ec)("p256");function g(e){return c.buf(e)>>>0}var E={BTC:n,ETH:o,ETH_MSG:a};e.exports={signReqResolver:E,aes256_decrypt:function(e,t){var r=s.from(f),n=new u.ModeOfOperation.cbc(t,r);return s.from(n.decrypt(e))},aes256_encrypt:function(e,t){var r=s.from(f),n=new u.ModeOfOperation.cbc(t,r),i=e.length%16===0?e:u.padding.pkcs7.pad(e);return s.from(n.encrypt(i))},parseDER:function(e){if(48!==e[0]||2!==e[2])return null;var t=3,r={r:null,s:null},n=e[t];if(t++,r.r=e.slice(t,t+n),2!==e[t+=n])return null;var i=e[++t];return t++,r.s=e.slice(t,t+i),r},checksum:g,parseLattice1Response:function(e){var t={err:null,data:null},r=s.from(e,"hex"),n=0,i=r.readUInt8(n);if(n++,i!==v)return t.err="Incorrect protocol version. Please update your SDK",t;var o=r.readUInt8(n);if(n++,0!==o)return t.err="Incorrect response from Lattice1",t;r.readUInt32BE(n),n+=4;var a=r.readUInt16BE(n);n+=2;var u=r.slice(n,n+a);n+=a;var c=u.readUInt8(0);return c!==d.RESP_SUCCESS?(t.err="Error from device: ".concat(p[c]?p[c]:"Unknown Error"),t.responseCode=c,t):(t.data=u.slice(1,u.length),r.readUInt32BE(n)!==g(r.slice(0,r.length-4))?(t.err="Invalid checksum from device response",t.data=null,t):t)},getP256KeyPair:function(e){return y.keyFromPrivate(e,"hex")},getP256KeyPairFromPub:function(e){return y.keyFromPublic(e,"hex")},toPaddedDER:function(e){var t=s.alloc(74);return s.from(e.toDER()).copy(t),t}}},1265:function(e,t,r){var n;n=function(e){e.version="1.2.0";var t=function(){for(var e=0,t=new Array(256),r=0;256!=r;++r)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=r)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[r]=e;return"undefined"!==typeof Int32Array?new Int32Array(t):t}();e.table=t,e.bstr=function(e,r){for(var n=-1^r,i=e.length-1,o=0;o<i;)n=(n=n>>>8^t[255&(n^e.charCodeAt(o++))])>>>8^t[255&(n^e.charCodeAt(o++))];return o===i&&(n=n>>>8^t[255&(n^e.charCodeAt(o))]),-1^n},e.buf=function(e,r){if(e.length>1e4)return function(e,r){for(var n=-1^r,i=e.length-7,o=0;o<i;)n=(n=(n=(n=(n=(n=(n=(n=n>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])];for(;o<i+7;)n=n>>>8^t[255&(n^e[o++])];return-1^n}(e,r);for(var n=-1^r,i=e.length-3,o=0;o<i;)n=(n=(n=(n=n>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])])>>>8^t[255&(n^e[o++])];for(;o<i+3;)n=n>>>8^t[255&(n^e[o++])];return-1^n},e.str=function(e,r){for(var n,i,o=-1^r,a=0,s=e.length;a<s;)(n=e.charCodeAt(a++))<128?o=o>>>8^t[255&(o^n)]:n<2048?o=(o=o>>>8^t[255&(o^(192|n>>6&31))])>>>8^t[255&(o^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),i=1023&e.charCodeAt(a++),o=(o=(o=(o=o>>>8^t[255&(o^(240|n>>8&7))])>>>8^t[255&(o^(128|n>>2&63))])>>>8^t[255&(o^(128|i>>6&15|(3&n)<<4))])>>>8^t[255&(o^(128|63&i))]):o=(o=(o=o>>>8^t[255&(o^(224|n>>12&15))])>>>8^t[255&(o^(128|n>>6&63))])>>>8^t[255&(o^(128|63&n))];return-1^o}},"undefined"===typeof DO_NOT_EXPORT_CRC?n(t):n({})},804:function(e,t,r){var n,i=r(366),o={finalizePair:0,getAddresses:1290,sign:1090,getWallets:142,test:1646},a=0;Object.keys(o).forEach((function(e){o[e]+82>a&&(a=o[e]+82)}));var s={RESP_SUCCESS:0,RESP_ERR_INVALID_MSG:128,RESP_ERR_UNSUPPORTED_VER:129,RESP_ERR_DEV_BUSY:130,RESP_ERR_USER_TIMEOUT:131,RESP_ERR_USER_DECLINED:132,RESP_ERR_PAIR_FAIL:133,RESP_ERR_PAIR_DISABLED:134,RESP_ERR_PERMISSION_DISABLED:135,RESP_ERR_INTERNAL:136,RESP_ERR_GCE_TIMEOUT:137,RESP_ERR_WALLET_NOT_PRESENT:138,RESP_ERR_DEV_LOCKED:139,RESP_ERR_DISABLED:140},u=(i(n={},s.RESP_SUCCESS,0),i(n,s.RESP_ERR_INVALID_MSG,"Invalid Request"),i(n,s.RESP_ERR_UNSUPPORTED_VER,"Unsupported Version"),i(n,s.RESP_ERR_DEV_BUSY,"Device Busy"),i(n,s.RESP_ERR_USER_TIMEOUT,"Timeout Waiting for User"),i(n,s.RESP_ERR_USER_DECLINED,"Request Declined by User"),i(n,s.RESP_ERR_PAIR_FAIL,"Pairing Failed"),i(n,s.RESP_ERR_PAIR_DISABLED,"Pairing is Currently Disabled"),i(n,s.RESP_ERR_PERMISSION_DISABLED,"Automated Signing is Currently Disabled"),i(n,s.RESP_ERR_INTERNAL,"Device Error"),i(n,s.RESP_ERR_GCE_TIMEOUT,"Timeout"),i(n,s.RESP_ERR_WALLET_NOT_PRESENT,"Incorrect Wallet UID Provided"),i(n,s.RESP_ERR_DEV_LOCKED,"Device Locked"),i(n,s.RESP_ERR_DISABLED,"Disabled"),n);e.exports={ADDR_STR_LEN:129,AES_IV:[109,121,115,101,99,114,101,116,112,97,115,115,119,111,114,100],BASE_URL:"https://signing.gridpl.us",ENC_MSG_LEN:a,addressSizes:{BTC:20,ETH:20},decResLengths:o,deviceCodes:{CONNECT:1,ENCRYPTED_REQUEST:2},encReqCodes:{FINALIZE_PAIRING:0,GET_ADDRESSES:1,ADD_PERMISSION:2,SIGN_TRANSACTION:3,GET_WALLETS:4,TEST:5},ethMsgProtocol:{SIGN_PERSONAL:0},messageConstants:{NOT_PAIRED:0,PAIRED:1},responseCodes:s,responseMsgs:u,signingSchema:{BTC_TRANSFER:0,ETH_TRANSFER:1,ERC20_TRANSFER:2,ETH_MSG:3},ETH_DATA_MAX_SIZE:1024,ETH_MSG_MAX_SIZE:1024,REQUEST_TYPE_BYTE:2,VERSION_BYTE:1,HARDENED_OFFSET:2147483648,HANDLE_LARGER_CHAIN_ID:255,MAX_CHAIN_ID_BYTES:8}},825:function(e,t,r){var n=r(219);e.exports=n("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},879:function(e,t,r){"use strict";var n=r(105),i=r(880);e.exports=i((function(e){var t=n("sha256").update(e).digest();return n("sha256").update(t).digest()}))},880:function(e,t,r){"use strict";var n=r(825),i=r(22).Buffer;e.exports=function(e){function t(t){var r=t.slice(0,-4),n=t.slice(-4),i=e(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function(t){var r=e(t);return n.encode(i.concat([t,r],t.length+4))},decode:function(e){var r=t(n.decode(e));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(e){var r=n.decodeUnsafe(e);if(r)return t(r)}}}},993:function(e,t,r){"use strict";e.exports=function(e){return null!==e&&"object"===typeof e}},994:function(e,t,r){var n=r(825),i=r(879),o=r(11).Buffer,a=r(804),s=o.from("01","hex"),u=r(804).HARDENED_OFFSET,c=[44+u,u,u,1,0],l=0,h=169,f=118,d=135,p=136,v=172,y={LEGACY:0,SEGWIT:5,TESTNET:111,SEGWIT_TESTNET:196};t.addressVersion=y;var g={P2PKH:1,P2SH:2,P2SH_P2WPKH:3};function E(e,t){return o.concat([e,t])}function w(e){var t=o.alloc(4);return t.writeUInt32LE(e),t}function _(e){var t;return e<253?(t=o.alloc(1)).writeUInt8(e):e<=65535?((t=o.alloc(3)).writeUInt8(253,0),t.writeUInt16LE(e,1)):e<4294967295?((t=o.alloc(5)).writeUInt8(254,0),t.writeUInt32LE(e,1)):((t=o.alloc(9)).writeUInt8(255,0),t.writeUInt32LE(e>>>0,1),t.writeUInt32LE(e/4294967296|0,5)),t}function m(e,t,r){"number"===typeof e&&(e=e.toString(16));var n=o.alloc(8),i=e.length%2===0?e.toString(16):"0".concat(e.toString(16));return o.from(i,"hex").reverse().copy(n,0),n.copy(t,r),n}t.scriptTypes=g,t.buildBitcoinTxRequest=function(e){try{var t=e.prevOuts,r=e.recipient,s=e.value,u=e.changePath,l=void 0===u?c:u,h=e.fee,f=e.isSegwit,d=e.changeVersion,p=void 0===d?"SEGWIT":d;if(5!==l.length)throw new Error("Please provide a full change path.");var v=o.alloc(59+69*t.length),E=0;if(void 0===y[p])throw new Error("Invalid change version specified.");v.writeUInt8(y[p]),E++,v.writeUInt32LE(l.length,E),E+=4;for(var w=0;w<l.length;w++)v.writeUInt32LE(l[w],E),E+=4;v.writeUInt32LE(h,E),E+=4;var _=n.decode(r)[0],b=i.decode(r).slice(1);v.writeUInt8(_,E),E++,b.copy(v,E),E+=b.length,m(s,v,E),E+=8,v.writeUInt8(t.length,E),E++;var S=0,R=!0===f?g.P2SH_P2WPKH:g.P2PKH;return t.forEach((function(e){if(!e.signerPath||5!==e.signerPath.length)throw new Error("Full recipient path not specified ");v.writeUInt32LE(e.signerPath.length,E),E+=4;for(var t=0;t<e.signerPath.length;t++)v.writeUInt32LE(e.signerPath[t],E),E+=4;v.writeUInt32LE(e.index,E),E+=4,m(e.value,v,E),E+=8,S+=e.value,v.writeUInt8(R,E),E++,o.isBuffer(e.txHash)||(e.txHash=o.from(e.txHash,"hex")),e.txHash.copy(v,E),E+=e.txHash.length})),{payload:v,schema:a.signingSchema.BTC_TRANSFER,origData:e,changeData:{changeVersion:p,value:S-(s+h)}}}catch(T){return{err:T}}},t.serializeTx=function(e){var t=e.inputs,r=e.outputs,a=e.isSegwitSpend,u=e.lockTime,c=void 0===u?0:u,g=e.crypto,b=o.alloc(4),S=0;b.writeUInt32LE(2,S),S+=4,!0===a&&(b=E(b,o.from("00","hex")),b=E(b,o.from("01","hex")));var R=_(t.length);b=E(b,R),S+=R.length,t.forEach((function(e){b=E(b,e.hash.reverse()),S+=e.hash.length;var t=w(e.index);if(b=E(b,t),S+=t.length,!0===a){var r=function(e,t){var r=o.alloc(22),n=t.createHash("sha256").update(e).digest(),i=t.createHash("rmd160").update(n).digest();return r.writeUInt8(l),r.writeUInt8(i.length,1),i.copy(r,2),r}(e.pubkey,g),n=_(r.length),i=o.concat([n,r]),u=_(i.length);b=E(b,u),S+=u.length,b=E(b,i),S+=i.length}else{var c=function(e,t){var r=_((e=o.concat([e,s])).length),n=_(t.length),i=o.concat([r,e,n,t]),a=_(i.length);return o.concat([a,i])}(e.sig,e.pubkey);b=E(b,c),S+=c.length}var h=w(4294967295);b=E(b,h),S+=h.length}));var T=_(r.length);if(b=E(b,T),S+=T.length,r.forEach((function(e){var t=function(e){var t=o.alloc(8);return m(e,t,0),t}(e.value);b=E(b,t),S+=t.length;var r=function(e){var t=n.decode(e)[0],r=i.decode(e).slice(1);return t===y.SEGWIT||t===y.SEGWIT_TESTNET?function(e){var t=o.alloc(3+e.length),r=0;return t.writeUInt8(h,r),r++,t.writeUInt8(e.length,r),r++,e.copy(t,r),r+=e.length,t.writeUInt8(d,r),r++,t}(r):function(e){var t=o.alloc(5+e.length),r=0;return t.writeUInt8(f,r),r++,t.writeUInt8(h,r),r++,t.writeUInt8(e.length,r),r++,e.copy(t,r),r+=e.length,t.writeUInt8(p,r),r++,t.writeUInt8(v,r),r++,t}(r)}(e.recipient),a=_(r.length);b=E(b,a),S+=a.length,b=E(b,r),S+=r.length})),!0===a){for(var I=[],k=[],A=0;A<t.length;A++)I.push(t[A].sig),k.push(t[A].pubkey);var P=function(e,t){var r=o.alloc(0),n=o.alloc(1);n.writeUInt8(2);for(var i=0;i<e.length;i++){var a=o.concat([e[i],s]),u=_(a.length),c=t[i],l=_(c.length);r=o.concat([r,n,u,a,l,c])}return r}(I,k);b=E(b,P),S+=P.length}return o.concat([b,w(c)]).toString("hex")},t.getBitcoinAddress=function(e,t){return i.encode(o.concat([o.from([t]),e]))}},995:function(e,t,r){var n=r(51),i=r(11).Buffer,o=r(804),a=r(365).keccak256,s=r(1260),u=r(1261);function c(e){for(var t=e[0];e.length>0&&"0"===t.toString();)t=(e=e.slice(1))[0];return e}function l(e,t,r,n,o){try{var s=new Uint8Array(i.from(a(e),"hex")),c=0,l=d(t.r,32);t.r=l;var h=d(t.s,32);t.s=h;var v=new Uint8Array(i.concat([l,h])),y=u.ecdsaRecover(v,c,s,!1).slice(1);if(f(y)===r.toString("hex"))return t.v=p(c,o,n),t;if(c=1,f(y=u.ecdsaRecover(v,c,s,!1).slice(1))===r.toString("hex"))return t.v=p(c,o,n),t;throw new Error("Invalid Ethereum signature returned.")}catch(g){throw new Error(g)}}function h(e){return null===e||0===e?i.alloc(0):(i.isBuffer(e)&&(e=e.toString("hex")),"number"===typeof e?e="".concat(e.toString(16)):"string"===typeof e&&"0x"===e.slice(0,2)&&(e=e.slice(2)),e.length%2>0&&(e="0".concat(e)),i.from(e,"hex"))}function f(e){return a(e).slice(-40)}function d(e,t){var r=i.alloc(t);return e.length<t?(e.copy(r,t-e.length),r):e.slice(-t)}function p(e,t,r){if(!1===t)return i.from(new n(e).plus(27).toString(16),"hex");var o=y(r);return h(new n(o.toString("hex"),16).times(2).plus(35).plus(e).toString(16))}t.buildEthereumMsgRequest=function(e){if(!e.payload||!e.protocol||!e.signerPath)throw new Error("You must provide `payload`, `signerPath`, and `protocol` arguments in the messsage request");var t,r={schema:o.signingSchema.ETH_MSG,payload:null,input:e,msg:null};if("signPersonal"===e.protocol){var n=4*(e.signerPath.length+1)+o.ETH_MSG_MAX_SIZE+4,a=0;r.payload=i.alloc(n),r.payload.writeUInt8(o.ethMsgProtocol.SIGN_PERSONAL,0),a+=1,r.payload.writeUInt32LE(e.signerPath.length,a),a+=4;for(var s=0;s<e.signerPath.length;s++)r.payload.writeUInt32LE(e.signerPath[s],a),a+=4;var u=e.payload,c=!1;if("string"===typeof e.payload)if("0x"===e.payload.slice(0,2))u=h(e.payload),c=!0===(t=e.payload.slice(2),/^[0-9a-fA-F]+$/.test(t));else{if(!1===function(e){for(var t=0;t<e.length;t++)if(e.charCodeAt(t)<32||e.charCodeAt(t)>127)return!1;return!0}(e.payload))throw new Error("Currently, the Lattice can only display ASCII strings.");u=i.from(e.payload)}else"boolean"===typeof e.displayHex&&(c=e.displayHex);if(u.length>o.ETH_MSG_MAX_SIZE)throw new Error("Your payload is ".concat(u.length," bytes, but can only be a maximum of ").concat(o.ETH_MSG_MAX_SIZE));return r.msg=u,r.payload.writeUInt8(c,a),a+=1,r.payload.writeUInt16LE(u.length,a),a+=2,u.copy(r.payload,a),r}throw new Error("Unsupported protocol")},t.validateEthereumMsgResponse=function(e,t){var r=e.signer,n=e.sig,o=t.input,a=t.msg;if("signPersonal"===o.protocol){var s=i.from("\x19Ethereum Signed Message:\n".concat(a.length.toString()),"utf-8");return l(i.concat([s,a]),n,r)}throw new Error("Unsupported protocol")},t.buildEthereumTxRequest=function(e){try{var t=e.chainId,r=void 0===t?1:t,n=e.signerPath,a=e.eip155,s=void 0===a?null:a;if("number"!==typeof r&&!1===g(r)&&(r=v[r]),!r)throw new Error("Unsupported chain ID or name");if(!n||5!==n.length)throw new Error("Please provider full signer path (`signerPath`)");var u=function(e){switch(e){case 3:case 4:return!1;case 1:case 42:case 5:default:return!0}}(r);null!==s&&"boolean"===typeof s&&(u=s),e.value||(e.value=0);var c=[],l=h(e.nonce),f=h(e.gasPrice),d=h(e.gasLimit),p=h(e.to),E=h(e.value),w=h(e.data);c.push(l),c.push(f),c.push(d),c.push(p),c.push(E),c.push(w),!0===u&&(c.push(h(r)),c.push(h(null)),c.push(h(null)));var _,m=i.alloc(1146),b=0;m.writeUInt8(Number(u),b),b++;var S=0;if(!0===function(e){var t=y(e);return 1!==t.length||255===t.readUInt8(0)}(r)){if((S=(_=y(r)).length)>o.MAX_CHAIN_ID_BYTES)throw new Error("ChainID provided is too large.");m.writeUInt8(o.HANDLE_LARGER_CHAIN_ID,b),b++}else{if(1!==(_=h(r)).length)throw new Error("Error parsing chainID");_.copy(m,b),b+=_.length}m.writeUInt32LE(n.length,b),b+=4;for(var R=0;R<n.length;R++)m.writeUInt32LE(n[R],b),b+=4;m.writeUInt32BE(e.nonce,b),b+=4,function(e,t,r){"number"===typeof e&&(e=e.toString(16));var n=i.alloc(8),o=e.length%2===0?e.toString(16):"0".concat(e.toString(16)),a=i.from(o,"hex");a.copy(n,n.length-a.length),n.copy(t,r)}(e.gasPrice,m,b),b+=8,m.writeUInt32BE(e.gasLimit,b),b+=4,p.copy(m,b);var T=(b+=20)+32-E.length;if(E.copy(m,T),b+=32,w&&w.length>o.ETH_DATA_MAX_SIZE)return{err:"Data field too large (must be <=".concat(o.ETH_DATA_MAX_SIZE," bytes)")};if(m.writeUInt16BE(w.length,b),b+=2,w.length+S>o.ETH_DATA_MAX_SIZE)throw new Error("Payload too large.");return S>0&&(m.writeUInt8(S,b),b++,_.copy(m,b),b+=S),w.copy(m,b),b+=o.ETH_DATA_MAX_SIZE,{rawTx:c,payload:m,schema:o.signingSchema.ETH_TRANSFER,chainId:r,useEIP155:u,signerPath:n}}catch(I){return{err:I.message}}},t.buildEthRawTx=function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=s.encode(e.rawTx),o=l(i,t,r,e.chainId,n),a=e.rawTx.slice(0,6);return a.push(o.v),a.push(c(o.r)),a.push(c(o.s)),s.encode(a).toString("hex")},t.addRecoveryParam=l,t.hashTransaction=function(e){return a(i.from(e,"hex"))};var v={mainnet:1,roptsten:3,rinkeby:4,kovan:42,goerli:5};function y(e){var t,r;if((t=!0===g(e)?h(e):h(new n(e).toString(16))).length>8)throw new Error("ChainID provided is too large.");return t.length<=2||4===t.length||8===t.length?t:(3===t.length?(r=i.alloc(4)).writeUInt32BE(e):t.length<=8&&(r=i.alloc(8),t.copy(r,8-t.length)),r)}function g(e){return!1===new n(e,16).isNaN()}t.chainIds=v}}]);
//# sourceMappingURL=19.e37d494a.chunk.js.map